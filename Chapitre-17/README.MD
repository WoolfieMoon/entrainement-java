## Chapitre 17 ‚Äì Les Arcanes du Web : introduction √† Java Spring Boot

Au c≈ìur des Citadelles Reli√©es, les mages les plus avanc√©s ne se contentent plus de lancer des sorts dans le vide : ils les exposent sous forme de portails web. Gr√¢ce √† l‚Äôart ancien du Spring Boot, tu vas apprendre √† b√¢tir des services REST, les publier, et permettre aux autres guildes de les invoquer √† distance.

Dans ce chapitre, tu vas apprendre √† :

    - Cr√©er un projet Spring Boot simple avec Maven

    - D√©finir un contr√¥leur REST (@RestController)

    - R√©pondre √† des requ√™tes HTTP (GET, POST, etc.)

    - Tester tes endpoints dans un navigateur ou avec Postman
# Exercice 1 ‚Äì L‚Äôinvocation du projet magique (cr√©ation Spring Boot)

**Contexte narratif :**  
Le grimoire num√©rique de la guilde doit maintenant √™tre **accessible depuis le r√©seau magique**. Pour cela, tu vas invoquer les fondations d‚Äôun projet Spring Boot.

**√ânonc√© :**
1. Cr√©e un projet Spring Boot avec Maven (en ligne ou avec IntelliJ/STS).
2. Nomme le projet `grimoire-web`.
3. Ajoute la d√©pendance `spring-boot-starter-web`.
4. Lance l‚Äôapplication et affiche dans la console :

üåÄ Le portail du Grimoire est ouvert.
# Exercice 2 ‚Äì Premier sort REST (Hello World)

**Contexte narratif :**  
Tu ouvres un **endroit magique** que d‚Äôautres mages peuvent invoquer √† distance.

**√ânonc√© :**
1. Cr√©e une classe `SortController` annot√©e avec `@RestController`.
2. Ajoute une m√©thode :
   ```java
   @GetMapping("/salutation")
   public String saluer() {
       return "‚ú® Salutations depuis le Grimoire !";
   }
3. Lance l‚Äôapplication et acc√®de √† http://localhost:8080/salutation pour tester.
# Exercice 3 ‚Äì Sort avec param√®tre

**Contexte narratif :**  
Un mage peut maintenant invoquer un sort avec son nom pour une r√©ponse personnalis√©e.

**√ânonc√© :**
1. Dans `SortController`, ajoute :
   ```java
   @GetMapping("/saluer/{nom}")
   public String saluerMage(@PathVariable String nom) {
       return "Bienvenue, " + nom + " !";
   }
2. Acc√®de √† http://localhost:8080/saluer/Kaelis

3. Le r√©sultat doit √™tre :

Bienvenue, Kaelis !
# Exercice 4 ‚Äì Sort JSON (objet retourn√©)

**Contexte narratif :**  
Tu veux renvoyer un **sortil√®ge** sous forme d‚Äôobjet, pour que d‚Äôautres guildes puissent le lire via un portail standardis√©.

**√ânonc√© :**
1. Cr√©e une classe `Sort` avec `nom` et `puissance`.
2. Dans `SortController`, ajoute :
   ```java
   @GetMapping("/sort")
   public Sort donnerSort() {
       return new Sort("√âclair", 90);
   }
3. Lance l‚Äôapp et acc√®de √† /sort
4. R√©sultat attendu :

{
"nom": "√âclair",
"puissance": 90
}
# Exercice 5 ‚Äì Enregistrement de sort (POST JSON)

**Contexte narratif :**  
Les guildes veulent t‚Äôenvoyer de nouveaux sorts pour qu‚Äôils soient enregistr√©s dans ton Grimoire.

**√ânonc√© :**
1. Dans `SortController`, ajoute :
   ```java
   @PostMapping("/sort")
   public String enregistrerSort(@RequestBody Sort sort) {
       return "üìù Sort re√ßu : " + sort.getNom() + " (" + sort.getPuissance() + ")";
   }

2. Envoie une requ√™te POST avec Postman ou curl :

{
"nom": "Feu",
"puissance": 100
}

3. R√©sultat attendu :

üìù Sort re√ßu : Feu (100)
# Exercice 6 ‚Äì Grimoire de sorts (liste de plusieurs objets)

**Contexte narratif :**  
Le Grimoire Web doit permettre de consulter une **liste compl√®te** de sorts accessibles √† distance.

**√ânonc√© :**
1. Dans `SortController`, cr√©e une m√©thode :
   ```java
   @GetMapping("/grimoires")
   public List<Sort> tousLesSorts() {
       return List.of(
           new Sort("√âclair", 90),
           new Sort("Feu", 100),
           new Sort("Invisibilit√©", 60)
       );
   }
2. Acc√®de √† http://localhost:8080/grimoires
3. Le JSON doit contenir un tableau d‚Äôobjets sortil√®ges.
# Exercice 7 ‚Äì Acc√®s aux sorts par ID (param√®tre dans URL)

**Contexte narratif :**  
Chaque sort est maintenant **identifi√© par un num√©ro** dans le Grimoire central.

**√ânonc√© :**
1. Cr√©e une m√©thode dans `SortController` :
   ```java
   @GetMapping("/sort/{id}")
   public Sort getSortById(@PathVariable int id) {
       List<Sort> sorts = List.of(
           new Sort("√âclair", 90),
           new Sort("Feu", 100),
           new Sort("Invisibilit√©", 60)
       );
       return sorts.get(id);
   }

2. Acc√®de √† /sort/0, /sort/1 etc.
3. Chaque appel retourne un objet JSON diff√©rent.
# Exercice 8 ‚Äì R√©ponses magiques conditionnelles

**Contexte narratif :**  
Certains sortil√®ges envoy√©s √† travers le portail sont **trop faibles** pour √™tre enregistr√©s dans le Grimoire. Le syst√®me doit **les refuser** et avertir le mage exp√©diteur.

---

## Objectif

Cr√©er une route `POST` qui :
- Re√ßoit un `Sort` en JSON
- V√©rifie la puissance du sort
- Retourne une r√©ponse texte diff√©rente selon la puissance

---

## √ânonc√© technique

1. Dans `SortController`, ajoute la m√©thode suivante :
   ```java
   @PostMapping("/sort-verification")
   public String verifierSort(@RequestBody Sort sort) {
       if (sort.getPuissance() < 50) {
           return "‚ö†Ô∏è Ce sort est trop faible.";
       } else {
           return "‚úÖ Sort enregistr√© avec succ√®s.";
       }
   }

2. Envoie une requ√™te POST √† /sort-verification avec ce JSON :

{
"nom": "Illusion",
"puissance": 30
}

R√©ponse attendue :

‚ö†Ô∏è Ce sort est trop faible.

3. Envoie ensuite :

{
"nom": "Explosion",
"puissance": 95
}

R√©ponse attendue :

‚úÖ Sort enregistr√© avec succ√®s.

4. Remplace la m√©thode par un ResponseEntity<String> pour renvoyer un code HTTP sp√©cifique :

@PostMapping("/sort-verification")
public ResponseEntity<String> verifierSort(@RequestBody Sort sort) {
if (sort.getPuissance() < 50) {
return ResponseEntity.badRequest().body("‚ö†Ô∏è Ce sort est trop faible.");
} else {
return ResponseEntity.ok("‚úÖ Sort enregistr√© avec succ√®s.");
}
}

# Exercice 9 ‚Äì Cr√©ation d‚Äôun service (classe m√©tier)

**Contexte narratif :**  
Tu veux **s√©parer les responsabilit√©s** : les sorts seront g√©r√©s par un **mage archiviste** (service).

**√ânonc√© :**
1. Cr√©e une classe `SortService` avec :
    - Une m√©thode `List<Sort> getAllSorts()`

2. Dans `SortController`, injecte `SortService` avec `@Autowired`
3. La m√©thode `/grimoires` appelle d√©sormais `getAllSorts()` du service

**But :**  
Appliquer la s√©paration Contr√¥leur / Service

# Exercice 10 ‚Äì Base temporaire en m√©moire

**Contexte narratif :**  
Tu veux **stocker temporairement** les sorts envoy√©s pour les restituer plus tard.

**√ânonc√© :**
1. Dans `SortService`, cr√©e une `List<Sort>` en tant qu‚Äôattribut
2. Ajoute une m√©thode `addSort(Sort s)` et une m√©thode `getAllSorts()`
3. Le `POST /sort` ajoute un sort √† la liste
4. Le `GET /grimoires` retourne tous les sorts enregistr√©s depuis le d√©marrage

**Attention :**  
Les donn√©es sont perdues si on red√©marre, car il s'agit d'une m√©moire **transitoire**

